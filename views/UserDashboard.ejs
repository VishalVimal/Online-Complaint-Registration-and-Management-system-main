<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Dashboard | FixIt</title>
    <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding-bottom: 5rem;
      }

      nav {
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        padding: 1rem 0;
      }

      nav .acc-name {
        padding: 0.75rem 1.25rem;
        border-radius: 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        text-transform: uppercase;
        color: white;
        font-weight: 700;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
      }

      nav .acc-name:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .nav-link {
        font-weight: 600;
        color: #2d3748 !important;
        padding: 0.5rem 1rem !important;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .nav-link:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea !important;
      }

      .btn-outline-dark {
        border: 2px solid #2d3748;
        color: #2d3748;
        font-weight: 600;
        padding: 0.5rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .btn-outline-dark:hover {
        background: #2d3748;
        color: white;
        transform: translateY(-2px);
      }

      .complaints-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .page-header {
        text-align: center;
        margin-bottom: 3rem;
        padding-top: 2rem;
      }

      .page-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
      }

      .page-header p {
        color: #718096;
        font-size: 1.1rem;
      }

      .complaints {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .complaint-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .complaint-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      }

      .complaint-card .card-img-top {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .complaint-card:hover .card-img-top {
        transform: scale(1.05);
      }

      .complaint-date {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        color: #718096;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .card-body {
        padding: 1.5rem;
      }

      .card-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 1rem;
      }

      .card-text {
        color: #718096;
        font-size: 0.95rem;
        margin-bottom: 1rem;
        line-height: 1.6;
      }

      .card-text a {
        color: #667eea;
        text-decoration: none;
        margin-left: 0.5rem;
        transition: all 0.3s ease;
      }

      .card-text a:hover {
        color: #764ba2;
        transform: scale(1.1);
      }

      .status-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        border: none;
        transition: all 0.3s ease;
      }

      .status-badge.approval {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .status-badge.work {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
      }

      .officer-info {
        background: #f7fafc;
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
      }

      .officer-info h6 {
        font-size: 0.9rem;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.5rem;
      }

      .officer-info a {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .officer-info a:hover {
        color: #764ba2;
        text-decoration: underline;
      }

      .feedback-section {
        margin-bottom: 1rem;
      }

      .feedback-trigger {
        cursor: pointer;
        color: #667eea;
        font-weight: 600;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
      }

      .feedback-trigger:hover {
        color: #764ba2;
      }

      .feedback-form {
        margin-top: 1rem;
        padding: 1rem;
        background: #f7fafc;
        border-radius: 12px;
      }

      .feedback-form textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-family: inherit;
        font-size: 0.9rem;
        resize: vertical;
        transition: all 0.3s ease;
      }

      .feedback-form textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      }

      .btn-action {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.85rem;
        border: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-delete {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .btn-delete:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .empty-state i {
        font-size: 4rem;
        color: #cbd5e0;
        margin-bottom: 1rem;
      }

      .empty-state h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 0.5rem;
      }

      .empty-state p {
        color: #718096;
        font-size: 1rem;
      }

      .add-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        font-size: 2rem;
        font-weight: 300;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .add-btn:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
      }

      @media (max-width: 768px) {
        .complaints {
          grid-template-columns: 1fr;
        }
        
        .page-header h1 {
          font-size: 2rem;
        }
        
        .add-btn {
          bottom: 1.5rem;
          right: 1.5rem;
          width: 50px;
          height: 50px;
          font-size: 1.5rem;
        }
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid px-4">
        <a class="navbar-brand" href="#">
          <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; font-size: 1.5rem;">
            FixIt <i class="bi bi-lightning-charge-fill"></i>
          </span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
            <li class="nav-item">
              <a class="nav-link active" href="/<%=userID%>/register-complaint">
                <i class="bi bi-plus-circle me-1"></i>New Complaint
              </a>
            </li>
            <li class="nav-item mx-3">
              <button class="acc-name"><i class="bi bi-person-circle me-1"></i><%= userName %></button>
            </li>
            <li class="nav-item">
              <button class="btn btn-outline-dark logout_btn" type="button">
                <i class="bi bi-box-arrow-right me-1"></i>Logout
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="complaints-container">
      <div class="page-header">
        <h1><i class="bi bi-clipboard-data"></i> My Complaints</h1>
        <p>Track and manage all your reported issues</p>
      </div>

      <% if (complaints.length==0) { %>
        <div class="empty-state">
          <i class="bi bi-inbox"></i>
          <h3>No Complaints Yet</h3>
          <p>Start by reporting your first community issue!</p>
        </div>
      <% } else { %>
        <div class="complaints">
          <% complaints.forEach(e=> { %>
            <div class="complaint-card card">
              <div class="complaint-date">
                <i class="bi bi-calendar3 me-1"></i><%=e.date %>
              </div>
              <img src="<%=e.imageURL %>" class="card-img-top" alt="Complaint Image" />
              <div class="card-body">
                <h5 class="card-title"><%=e.title %></h5>
                <p class="card-text">
                  <i class="bi bi-geo-alt-fill me-1"></i><strong>Address:</strong> <%=e.address %>
                  <a href="<%= e.gMapURL %>" target="_blank" title="View on Map">
                    <i class="bi bi-map"></i>
                  </a>
                </p>
                
                <div class="status-badges">
                  <span class="status-badge approval">
                    <i class="bi bi-check-circle me-1"></i>Approval: <%= e.approvalStatus %>
                  </span>
                  <span class="status-badge work">
                    <i class="bi bi-tools me-1"></i>Status: <%= e.workStatus %>
                  </span>
                </div>

                <div class="officer-info">
                  <h6><i class="bi bi-person-badge me-1"></i>Assigned Officer:</h6>
                  <a href="#"><%=e.officerAppointed %></a>
                </div>

                <div class="feedback-section">
                  <div class="feedback-trigger">
                    <i class="bi bi-chat-left-text"></i> Provide Feedback
                  </div>
                  <form class="feedback-form" action="" method="post" style="display: none">
                    <textarea name="" id="" rows="3" placeholder="Share your feedback about this complaint..."></textarea>
                    <button type="submit" class="btn btn-primary btn-sm mt-2" style="float: right;">
                      <i class="bi bi-send me-1"></i>Send
                    </button>
                  </form>
                </div>

                <form action="/delete-complaint/<%=e.id%>" method="post">
                  <button type="submit" class="btn-action btn-delete" name="dashboard" value="userDashboard">
                    <i class="bi bi-trash"></i> Delete Complaint
                  </button>
                </form>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>

    <a href="/<%=userID%>/register-complaint">
      <button class="add-btn" title="Add New Complaint">+</button>
    </a>

    <script>
      let logout_btn = document.querySelector(".logout_btn");
      logout_btn.addEventListener("click", () => {
        document.cookie = "jwt=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        window.location.href = "/sub-pages/login.html";
      });

      let feedbackTriggers = document.querySelectorAll(".feedback-trigger");
      let feedbackForms = document.querySelectorAll(".feedback-form");
      
      feedbackTriggers.forEach((trigger, index) => {
        trigger.addEventListener("click", () => {
          const form = feedbackForms[index];
          if (form.style.display === "none" || !form.style.display) {
            form.style.display = "block";
            trigger.innerHTML = '<i class="bi bi-x-circle"></i> Close Feedback';
          } else {
            form.style.display = "none";
            trigger.innerHTML = '<i class="bi bi-chat-left-text"></i> Provide Feedback';
          }
        });
      });
    </script>
  </body>
</html>
